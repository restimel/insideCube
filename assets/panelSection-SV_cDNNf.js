import{E as C,d as g,G as b,c as f,a as u,g as v,e as w,r as c,t as x,m as S,o as d,_}from"./index-MDkuAf7_.js";function n(e){return{name:e.name,color:e.color,start:{...e.start},end:{...e.end},levels:e.levels.map(s=>({name:s.name,cmt:s.cmt,lid:!!s.lid,cells:s.cells.map(t=>t.map(r=>({...r})))}))}}function m(){return{}}function y(e){return Array.from({length:e.cells},m)}function p(e,s,t=!1){return{name:s,lid:t,cells:Array.from({length:e.rows},()=>y(e))}}function N(e){return{name:"",color:"#000000",start:{x:1,y:1,z:0},end:{x:e.cells-2,y:e.rows-2,z:e.levels-1},levels:Array.from({length:e.levels},(s,t)=>p(e,`Level ${t+1}`,t===e.levels-1))}}const L=new Map([["black","#222623"],["blue","#3060e0"],["brown","#8b4513"],["crystal","#ffffff"],["green","#32cd32"],["orange","#ff8d1e"],["red","#ff0000"],["yellow","#ffff00"],["pink","#ff1493"]]);function k(e){return L.get(e)??e}function z(e){let s=e.start,t=e.end;return s?Array.isArray(s)&&(s={x:s[1],y:s[0],z:s[2]}):s={x:1,y:1,z:0},t?Array.isArray(t)&&(t={x:t[1],y:t[0],z:t[2]}):t={x:e.levels[0].cells[0].length-2,y:e.levels[0].cells.length-2,z:e.levels.length-1},{name:e.name,color:k(e.color),start:s,end:t,levels:e.levels.map(i=>({name:i.name,cmt:i.cmt,lid:!!i.lid,cells:i.cells.map(a=>a.map(o=>({r:!!o.r,d:!!o.d,b:!!o.b,s:o.s})))}))}}function T(e){const s={name:e.name,color:e.color,levels:e.levels.map(t=>{const r={name:t.name,cells:t.cells.map(i=>i.map(a=>{const o={};return a.r&&(o.r=1),a.d&&(o.d=1),a.b&&(o.b=1),a.s&&(o.s=a.s),o}))};return t.cmt&&(r.cmt=t.cmt),t.lid&&(r.lid=1),r})};if(e.start){let t,r,i;Array.isArray(e.start)?[r,t,i]=e.start:(t=e.start.x,r=e.start.y,i=e.start.z),(t!==1||r!==1||i!==1)&&(s.start=[r,t,i])}if(e.end){let t,r,i;Array.isArray(e.end)?[r,t,i]=e.end:(t=e.end.x,r=e.end.y,i=e.end.z),(t!==e.levels[0].cells[0].length-2||r!==e.levels[0].cells.length-2||i!==e.levels.length-1)&&(s.end=[r,t,i])}return s}const A=C("cube",{state:()=>({cubes:new Map,activeCube:null,dimensions:{levels:7,rows:6,cells:6},history:[],historyIndex:-1,tool:"hole"}),getters:{},actions:{getCubeByName(e){return this.cubes.get(e)},setCube(e,s){const t=s||e.name;return t?(this.cubes.set(t,e),t!==e.name&&this.cubes.delete(t),this.selectCube(e.name),this.saveCubesToLocalStorage(),!0):!1},createNewCube(){this.activeCube=N(this.dimensions)},deleteCube(e){const s=this.cubes.delete(e.name);return this.selectCube(),this.saveCubesToLocalStorage(),s},selectCube(e="",s=!1){let t;if(typeof e=="string"){let r=e&&this.getCubeByName(e);if(!r){if(s)return!1;const i=this.cubes.values().next().value;if(!i)return!1;r=n(i)}t=r}else t=n(e);return t?(this.activeCube=n(t),this.updateDimensions(),!0):s?!1:(this.createNewCube(),!0)},updateCubeProperty(e,s){this.activeCube||this.createNewCube(),this.activeCube[e]=s,this.addToHistory("history.updateCube",{property:e})},updateCubeSize(e,s){const t=this.dimensions[e],r=this.activeCube;if(t===s||!r)return;this.dimensions[e]=s;const i=t<s,a=this.dimensions;switch(e){case"levels":if(i)for(let o=t;o<s;o++)r.levels[o]=p(a,`Level ${o+1}`);else r.levels=r.levels.slice(0,s);this.addToHistory("history.updateCubeDimension",{property:e});break;case"rows":r.levels.forEach(o=>{if(i)for(let l=t;l<s;l++)o.cells.push(y(a));else o.cells=o.cells.slice(0,s)}),this.addToHistory("history.updateLevelDimension",{property:e});break;case"cells":r.levels.forEach(o=>{o.cells.forEach(l=>{if(i)for(let h=t;h<s;h++)l.push(m());else l.splice(s,1/0)})}),this.addToHistory("history.updateLevelDimension",{property:e});break}},updateDimensions(){const e=this.activeCube;e&&(this.dimensions={levels:e.levels.length,rows:e.levels[0].cells.length,cells:e.levels[0].cells[0].length})},updateLevelName(e,s){var r;const t=(r=this.activeCube)==null?void 0:r.levels[e];t&&(t.name=s,this.addToHistory("history.levelName",{name:s,index:e+1}))},toggleWall(e,s,t,r){var l;const i=this.activeCube,a=i==null?void 0:i.levels[e],o=(l=a==null?void 0:a.cells[s])==null?void 0:l[t];!i||!a||!o||(o[r]=!o[r],this.addToHistory("history.toggleWall",{row:s,col:t,index:e+1}))},toolCell(e,s,t){var l;const r=this.activeCube,i=r==null?void 0:r.levels[e],a=(l=i==null?void 0:i.cells[s])==null?void 0:l[t];if(!r||!i||!a)return;const o=this.tool;switch(o){case"hole":a.b=!a.b;break;case"start":r.start={x:t,y:s,z:e};break;case"finish":r.end={x:t,y:s,z:e};break}this.addToHistory("history.toggleCell",{row:s,col:t,tool:o,index:e+1})},export(e=[]){let s=Array.from(this.cubes.values());e.length&&(s=s.filter(r=>e.includes(r.name)));const t=s.map(T);return JSON.stringify(t)},import(e,s=!1){const t=[];let r=0;if(e){try{const i=JSON.parse(e);for(const a of i){const o=z(a);this.cubes.has(o.name)?s?(this.setCube(o),r++):t.push(o.name):(this.setCube(o),r++)}}catch(i){return{type:"error",message:"messages.invalidJsonFormat",details:i.message}}return this.saveCubesToLocalStorage(),t.length?{type:"warning",message:"messages.skippingCubes",details:t}:{type:"success",message:"messages.importSuccess",details:r}}return{type:"warning",message:"messages.enterJsonData"}},saveCubesToLocalStorage(){const e=this.export();localStorage.setItem("cubes",e)},loadCubesFromLocalStorage(){const e=localStorage.getItem("cubes");this.import(e)},addToHistory(e,s,t=!1){if(this.activeCube===null)return;const r=this.historyIndex,i=this.history;r<i.length-1&&(this.history=i.slice(0,r+1)),this.history.push({timestamp:new Date,description:e,details:s,cube:n(this.activeCube),notUndoable:t}),this.historyIndex=this.history.length-1},undo(e){e===void 0&&(e=this.historyIndex-1),e>=0&&e<this.history.length&&(this.historyIndex=e,this.activeCube=n(this.history[this.historyIndex].cube),this.updateDimensions())},redo(e){e===void 0&&(e=this.historyIndex+1),e>=0&&e<this.history.length&&(this.historyIndex=e,this.activeCube=n(this.history[this.historyIndex].cube),this.updateDimensions())}}}),D=A();D.loadCubesFromLocalStorage();const I={class:"panel-container"},H={class:"panel-header"},B={class:"panel-content"},E={key:0,class:"panel-footer"},$=g({__name:"panelSection",props:{title:{}},setup(e){const s=e,t=b();return(r,i)=>(d(),f("section",I,[u("header",H,[w(x(s.title)+" ",1),c(r.$slots,"header",{},void 0)]),u("div",B,[c(r.$slots,"default",{},void 0)]),S(t).footer?(d(),f("footer",E,[c(r.$slots,"footer",{},void 0)])):v("",!0)]))}}),V=_($,[["__scopeId","data-v-95e3fc8e"]]);export{V as B,A as u};
